@{
    ViewBag.Title = "Expedición Oxígeno";
    var reviews = ViewBag.Reviews as List<Proyecto_ExpedicionOxigeno.Models.Review>;
    var hasFilters = !string.IsNullOrEmpty(Request["servicio"]) || !string.IsNullOrEmpty(Request["calificacionMinima"]);
}



@if (!hasFilters)
{
    @section HeroBanner {
        <div class="hero-banner">
            <video autoplay muted loop playsinline>
                <source src="~/Content/Videos/Herobanner2.mp4" type="video/mp4">
                Tu navegador no soporta la etiqueta de video.
            </video>
            <div class="hero-content animate__animated animate__fadeIn">
                <h1 class="text-shadow">Bienvenido a @ViewBag.Title</h1>
                <p class="text-shadow">La aventura comienza aquí</p>
                <div class="hero-buttons">
                    <a href="#inicio" class="btn btn-outline-light btn-lg mt-4 animate__animated animate__fadeInUp">Explorar</a>
                    <a href="/reservas" class="btn btn-Primary-ExpOxi btn-lg mt-4 ms-3 animate__animated animate__fadeInUp animate__delay-1s">¡Reserva Ahora!</a>
                </div>
            </div>
        </div>
        <div class="hero-spacer"></div>
    }
}
<main class="container py-4">
    <section id="inicio" class="text-center mb-5">
        <div class="company-banner mb-4 animate__animated animate__fadeIn">
            <img src="~/Resources/Images/logoOxigeno.png" alt="Expedición Oxígeno" class="img-fluid" style="max-width: 60%; height: auto;">
        </div>
        <div class="company-info animate__animated animate__fadeInUp">
            <h1 class="display-4 fw-bold" style="color: #28a745; text-shadow: 1px 1px 3px rgba(0,0,0,0.2);">Expedición Oxígeno</h1>
            <p class="lead fw-semibold mt-3" style="color: #212529;">¡Viví la experiencia favorita de los amantes de la adrenalina!</p>
            <div class="decorative-line mx-auto my-3"></div>
        </div>
    </section>

    <style>
        .company-banner img {
            transition: transform 0.3s ease;
        }

            .company-banner img:hover {
                transform: scale(1.02);
            }

        .decorative-line {
            height: 3px;
            width: 150px;
            background: linear-gradient(90deg, transparent, #28a745, transparent);
        }

        .company-info {
            padding: 10px;
        }
    </style>

    <!-- Carrusel de imágenes mejorado -->
    <section class="mb-5">
        <div id="expedicionCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
            <div class="carousel-inner rounded shadow">
                <div class="carousel-item active">
                    <img src="~/Content/Images/Carrousel1.png" class="d-block w-100" alt="Expedición Imagen 1">
                    <div class="carousel-caption d-none d-md-block bg-dark-transparent rounded p-2">
                        <h3>Aventuras inolvidables</h3>
                        <p>Desafía tus límites en nuestras instalaciones</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="~/Content/Images/Carrousel2.png" class="d-block w-100" alt="Expedición Imagen 2">
                    <div class="carousel-caption d-none d-md-block bg-dark-transparent rounded p-2">
                        <h3>Experiencias únicas</h3>
                        <p>Momentos que recordarás para siempre</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="~/Content/Images/Carrousel3.png" class="d-block w-100" alt="Expedición Imagen 3">
                    <div class="carousel-caption d-none d-md-block bg-dark-transparent rounded p-2">
                        <h3>Adrenalina pura</h3>
                        <p>Siente la emoción en cada actividad</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="~/Content/Images/Carrousel4.png" class="d-block w-100" alt="Expedición Imagen 4">
                    <div class="carousel-caption d-none d-md-block bg-dark-transparent rounded p-2">
                        <h3>Diversión garantizada</h3>
                        <p>Para todas las edades</p>
                    </div>
                </div>
                <div class="carousel-item">
                    <img src="~/Content/Images/Carrousel5.png" class="d-block w-100" alt="Expedición Imagen 5">
                    <div class="carousel-caption d-none d-md-block bg-dark-transparent rounded p-2">
                        <h3>Seguridad en todo momento</h3>
                        <p>Equipo profesional y certificado</p>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#expedicionCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Anterior</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#expedicionCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Siguiente</span>
            </button>
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#expedicionCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#expedicionCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#expedicionCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                <button type="button" data-bs-target="#expedicionCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
                <button type="button" data-bs-target="#expedicionCarousel" data-bs-slide-to="4" aria-label="Slide 5"></button>
            </div>
        </div>
    </section>

    <style>
        .list-group-item {
            background-color: transparent !important;
            border: none !important;
        }
        .btn-reserva {
            background-color: rgb(250, 143, 35) !important;
            color: white !important;
            font-weight: 600;
            border-color: rgb(250, 143, 35) !important;
            transition: all 0.3s ease;
        }

            .btn-reserva:hover {
                background-color: rgb(230, 123, 15) !important;
                border-color: rgb(230, 123, 15) !important;
                color: white !important;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            }

        .floating-reserve-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border-radius: 50px;
        }

        .pulse-btn {
            animation: pulse 2s infinite;
        }

        @@keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7);
            }

            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(220, 53, 69, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0);
            }
        }

        .text-shadow {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
        }

        .bg-dark-transparent {
            background-color: rgba(0,0,0,0.6);
        }

        .carousel-fade .carousel-item {
            transition: opacity 0.6s ease !important;
        }

        .hero-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }
    </style>

    <section id="acerca" class="my-5">
        <div class="text-center mb-4">
            <h2 class="fw-bold" style="color: #28a745; text-shadow: 1px 1px 3px rgba(0,0,0,0.2);">Nuestras Actividades</h2>
            <p class="lead">Conoce nuestras emocionantes experiencias</p>
            <div class="decorative-line mx-auto mb-4"></div>
        </div>

        <div class="row row-cols-1 row-cols-md-3 g-4">
            @if (ViewBag.Servicios != null)
            {
                foreach (var servicio in ViewBag.Servicios)
                {
                    <div class="col animate__animated animate__fadeIn">
                        <div class="card h-100 activity-card shadow-sm">
                            <div class="card-body">
                                <div class="activity-icon mb-3">
                                    @if (servicio.DisplayName.Contains("Escalada"))
                                    {
                                        <i class="fas fa-mountain"></i>
                                    }
                                    else if (servicio.DisplayName.Contains("Cuerdas"))
                                    {
                                        <i class="fas fa-route"></i>
                                    }
                                    else if (servicio.DisplayName.Contains("Glider"))
                                    {
                                        <i class="fas fa-wind"></i>
                                    }
                                    else
                                    {
                                        <i class="fas fa-tree"></i>
                                    }
                                </div>
                                <h4 class="card-title">@servicio.DisplayName</h4>
                                <p class="card-text">@servicio.Description</p>
                                <div class="activity-details mt-3">
                                    <span class="duration">
                                        <i class="far fa-clock me-1"></i>
                                        @if (servicio.DefaultDuration.TotalHours >= 1)
                                        {
                                            @($"{Math.Floor(servicio.DefaultDuration.TotalHours)}h {servicio.DefaultDuration.Minutes}m")
                                        }
                                        else
                                        {
                                            @($"{servicio.DefaultDuration.Minutes}m")
                                        }
                                    </span>
                                    <span class="price">
                                        <i class="fas fa-tag me-1"></i>
                                        ₡@string.Format("{0:N2}", servicio.DefaultPrice)
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center">
                    <div class="alert alert-info">
                        No hay servicios disponibles en este momento.
                    </div>
                </div>
            }
        </div>
    </section>


    <style>
        .activity-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
            border: none;
        }

            .activity-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
            }

        .activity-icon {
            text-align: center;
            font-size: 2.5rem;
            color: #28a745;
            margin-bottom: 1rem;
        }

        .activity-details {
            display: flex;
            justify-content: space-between;
            padding-top: 1rem;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .duration, .price {
            font-weight: 500;
            color: #555;
            font-size: 0.9rem;
        }

        .card-footer {
            background-color: rgba(40, 167, 69, 0.05);
            border-top: none;
        }
    </style>

    <section id="resenas" class="mb-5">
        <h2 class="mb-4 text-center" style="color: #000;">Reseñas y Comentarios</h2>

        <div class="row">
            <div class="col-md-7">
                <p style="color: #000;">
                    Leé lo que opinan nuestros visitantes y dejá tu comentario para seguir mejorando la experiencia.
                </p>

                <h4 class="mt-4" style="color: #000;">Filtrar reseñas:</h4>

                <form method="get" action="/Home/Index#resenas" class="row mb-4">
                    <div class="col-md-6">
                        <label for="calificacionFiltro" class="form-label">Calificación</label>
                        <select id="calificacionFiltro" name="calificacion" class="form-select">
                            <option value="">Todas</option>
                            <option value="5">★★★★★</option>
                            <option value="4">★★★★☆ o más</option>
                            <option value="3">★★★☆☆ o más</option>
                            <option value="2">★★☆☆☆ o más</option>
                            <option value="1">★☆☆☆☆ o más</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="servicioFiltro" class="form-label">Tipo de servicio</label>
                        <select id="servicioFiltro" name="servicio" class="form-select">
                            <option value="">Todos</option>
                            <option value="Parque de Cuerdas">Parque de Cuerdas</option>
                            <option value="Pared de Escalada">Pared de Escalada</option>
                            <option value="Roll Glider">Roll Glider</option>
                        </select>
                    </div>
                    <div class="col-md-6 mt-3">
                        <button type="submit" class="btn btn-outline-success">Aplicar filtros</button>
                    </div>

                </form>

                <h4 class="mt-4" style="color: #000;">Reseñas recientes:</h4>

                @if (reviews != null && reviews.Any())
                {
                    foreach (var item in reviews)
                    {
                        <div class="border rounded p-3 mb-3 shadow-sm bg-light">
                            <strong>@item.Nombre</strong>
                            <div class="text-warning small mb-1">
                                @Html.Raw(new string('★', item.Calificacion))@Html.Raw(new string('☆', 5 - item.Calificacion))
                            </div>
                            <p class="mb-1"><strong>Servicio:</strong> @item.Servicio</p>
                            <p>@item.Comentario</p>
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted">No hay reseñas con los filtros seleccionados.</p>
                }

                <h4 class="mb-3" style="color: #000;">Dejanos tu reseña:</h4>

                @if (!Request.IsAuthenticated)
                {
                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#loginRequiredModal">
                        Comentar / Enviar reseña
                    </button>
                }
                else
                {
                    <form method="post" action="/Home/Index" onsubmit="return validarComentario()">
                        @Html.AntiForgeryToken()

                        <div class="mb-3">
                            <label for="Comentario" class="form-label">Comentario</label>
                            <textarea class="form-control" id="Comentario" name="Comentario" rows="4"
                                      placeholder="¿Qué te pareció tu experiencia?" minlength="4" required></textarea>
                            <div id="comentario-error" class="text-danger mt-1" style="display:none;">
                                El comentario debe tener al menos 4 caracteres. Por favor, escribe una reseña más detallada.
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="Calificacion" class="form-label">Calificación</label>
                            <select class="form-select" id="Calificacion" name="Calificacion" required>
                                <option value="">Seleccione una calificación</option>
                                <option value="5">★★★★★ - Excelente</option>
                                <option value="4">★★★★☆ - Muy bueno</option>
                                <option value="3">★★★☆☆ - Bueno</option>
                                <option value="2">★★☆☆☆ - Regular</option>
                                <option value="1">★☆☆☆☆ - Malo</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="Servicio" class="form-label">Tipo de servicio</label>
                            <select class="form-select" id="Servicio" name="Servicio" required>
                                <option value="">Seleccione un servicio</option>
                                <option value="Parque de Cuerdas">Parque de Cuerdas</option>
                                <option value="Pared de Escalada">Pared de Escalada</option>
                                <option value="Roll Glider">Roll Glider</option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-success">Enviar reseña</button>
                    </form>

                    <script>
                        function validarComentario() {
                            const comentario = document.getElementById("Comentario").value.trim();
                            const error = document.getElementById("comentario-error");

                            if (comentario.length < 4) {
                                error.style.display = "block";
                                return false;
                            }

                            error.style.display = "none";
                            return true;
                        }
                    </script>

                }
            </div>

            <div class="col-md-5 d-none d-md-block">
                <img src="/Content/Images/resena.jpg" alt="Opiniones de clientes" class="img-fluid rounded shadow-sm ai-style-change-1">
            </div>
        </div>
    </section>


    <section id="contacto" class="mt-5 mb-5">
        <h2 class="text-center" style="color: #000;">Contacto</h2>
        <div class="row justify-content-center align-items-center">
            <div class="col-md-7">
                <p>
                    Ubicación: O2<br />
                    Horario: De lunes a viernes de 1:00pm a 7:00pm. <br />
                    Sábados y domingos de 12:00pm a 7:00pm.<br />
                    Número Telefónico: 2520-2100
                </p>

                @if (!Request.IsAuthenticated)
                {
                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#loginRequiredModal">
                        Enviar consulta
                    </button>
                }
                else
                {
                    <form method="post" action="/Home/GuardarContacto">
                        @Html.AntiForgeryToken()

                        <div class="mb-3">
                            <label for="Consulta" class="form-label">Escríbenos tu consulta:</label>
                            <textarea class="form-control" id="Consulta" name="Consulta" rows="3" placeholder="¿Cuál es tu consulta?"></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="Telefono" class="form-label">Número de teléfono:</label>
                            <input type="tel" class="form-control" id="Telefono" name="Telefono" placeholder="Ej: 8888-8888">
                        </div>

                        <div class="mb-3">
                            <label for="Email" class="form-label">Correo electrónico:</label>
                            <input type="email" class="form-control" id="Email" name="Email" placeholder="correo@ejemplo.com">
                        </div>

                        <button type="submit" class="btn btn-success">Enviar</button>
                    </form>
                }
            </div>
            <div class="col-md-5 d-none d-md-block">
                <img src="/Content/Images/contacto.jpg" alt="Opiniones de clientes" class="img-fluid rounded shadow-sm ai-style-change-1">
            </div>
        </div>
    </section>
</main>

<!-- SIN la clase d-none -->
<div class="floating-reserve-btn" id="botonReserva">
    <a href="/reservas" class="btn btn-lg btn-reserva pulse-btn">
        <i class="fas fa-calendar-check"></i> ¡RESERVA YA!
    </a>
</div>

<style>
    body, html {
        overflow-x:clip;
    }
</style>


@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    @if (TempData["ResenaGuardada"] != null)
    {
        <script>
            Swal.fire({
                icon: 'success',
                title: '¡Gracias por tu reseña!',
                text: 'Una vez verificada, la agregaremos a la página principal.',
                confirmButtonColor: '#198754'
            });
        </script>
    }

    @if (TempData["MensajeEnviado"] != null)
    {
        <script>
            Swal.fire({
                icon: 'success',
                title: '¡Consulta enviada!',
                text: 'Una vez revisada, te contactaremos al correo.',
                confirmButtonColor: '#198754'
            });
        </script>
    }

    @if (TempData["RegistroExitoso"] != null)
    {
        <script>
            Swal.fire({
                icon: 'success',
                title: '¡Registro exitoso!',
                text: 'Gracias por registrarte. Te llegará un correo a la dirección brindada con un enlace para confirmar tu cuenta.',
                confirmButtonColor: '#198754'
            });
        </script>
    }

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const boton = document.getElementById('botonReserva');
            const hero = document.querySelector('.hero-banner');

            function toggleBoton() {
                if (!boton) return;

                if (hero) {
                    const heroBottom = hero.offsetTop + hero.offsetHeight;
                    if (window.scrollY > heroBottom - 50) {
                        boton.classList.remove('d-none');
                    } else {
                        boton.classList.add('d-none');
                    }
                } else {
                    // Si no hay HeroBanner, mostrar siempre
                    boton.classList.remove('d-none');
                }
            }

            window.addEventListener('scroll', toggleBoton);
            toggleBoton(); // 👈 Esto es lo que faltaba
        });
    </script>


}