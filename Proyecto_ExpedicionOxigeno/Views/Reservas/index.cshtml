@model IEnumerable<Microsoft.Graph.Models.BookingAppointment>

@{
    ViewBag.Title = "Nueva reserva";
}

<h2>@ViewBag.Title</h2>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header">
                <h4>Selecciona un servicio y fecha</h4>
            </div>
            <div class="card-body">
                @if (ViewBag.Services != null)
                {
                    <form action="@Url.Action("SeleccionarServicio", "Reservas")" method="get">
                        <div class="form-group mb-4">
                            <label for="fecha" class="form-label">Selecciona la fecha deseada:</label>
                            <input type="date" id="fecha" name="fecha" class="form-control"
                                   min="@DateTime.Today.ToString("yyyy-MM-dd")"
                                   max="@DateTime.Today.AddMonths(3).ToString("yyyy-MM-dd")"
                                   value="@DateTime.Today.ToString("yyyy-MM-dd")" required />
                            <small class="form-text text-muted">Selecciona la fecha para ver la disponibilidad.</small>
                        </div>

                        <h5 class="mb-3">Selecciona un servicio:</h5>
                        <div class="list-group">
                            @foreach (var service in ViewBag.Services)
                            {
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col-auto">
                                            <input class="form-check-input" type="radio" name="id"
                                                   id="service-@service.Id" value="@service.Id" required>
                                        </div>
                                        <div class="col">
                                            <label class="form-check-label w-100" for="service-@service.Id">
                                                <span class="d-block fw-bold">@service.DisplayName</span>
                                            </label>
                                            <p class="mb-1">@service.Description</p>
                                            <small>
                                                @if (service.DefaultDuration.TotalHours >= 1)
                                                {
                                                    @($"{Math.Floor(service.DefaultDuration.TotalHours)} horas {service.DefaultDuration.Minutes} minutos")
                                                }
                                                else
                                                {
                                                    @($"{service.DefaultDuration.Minutes} minutos")
                                                }
                                                | @string.Format("{0:C}", service.DefaultPrice)
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">Ver disponibilidad</button>
                        </div>
                    </form>
                }
                else
                {
                    <p>No hay servicios disponibles en este momento.</p>
                }
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h4>Información</h4>
            </div>
            <div class="card-body">
                <p>Selecciona uno de nuestros servicios y la fecha deseada para continuar con la reserva.</p>
                <p>Una vez seleccionados, podrás elegir el horario que más te convenga.</p>
                <hr>
                <h5>Nuestros horarios:</h5>
                <ul>
                    <li>Lunes a viernes: 1:00 pm - 7:00 pm</li>
                    <li>Sábados y domingos: 12:00 pm - 7:00 pm</li>
                </ul>
            </div>
        </div>
    </div>
</div>